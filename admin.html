<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RaycityIN - í‚¤ ê´€ë¦¬</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #4fc3f7;
        }
        .card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .card h2 {
            margin-bottom: 15px;
            color: #81d4fa;
            font-size: 18px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #b0bec5;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #37474f;
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 14px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4fc3f7;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #4fc3f7;
            color: #000;
        }
        .btn-primary:hover {
            background: #29b6f6;
        }
        .btn-danger {
            background: #ef5350;
            color: #fff;
        }
        .btn-danger:hover {
            background: #e53935;
        }
        .btn-warning {
            background: #ffb74d;
            color: #000;
        }
        .btn-warning:hover {
            background: #ffa726;
        }
        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        th {
            color: #4fc3f7;
            font-weight: 600;
        }
        .status-active {
            color: #69f0ae;
        }
        .status-expired {
            color: #ef5350;
        }
        .status-unbound {
            color: #ffb74d;
        }
        .generated-key {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 18px;
            text-align: center;
            color: #69f0ae;
            margin-top: 10px;
            user-select: all;
        }
        .alert {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .alert-success {
            background: rgba(105, 240, 174, 0.2);
            border: 1px solid #69f0ae;
            color: #69f0ae;
        }
        .alert-error {
            background: rgba(239, 83, 80, 0.2);
            border: 1px solid #ef5350;
            color: #ef5350;
        }
        .row {
            display: flex;
            gap: 15px;
        }
        .row > * {
            flex: 1;
        }
        #message {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”‘ RaycityIN í‚¤ ê´€ë¦¬</h1>
        
        <div id="message" class="alert"></div>
        
        <!-- í‚¤ ë°œê¸‰ -->
        <div class="card">
            <h2>â• ìƒˆ í‚¤ ë°œê¸‰</h2>
            <div class="row">
                <div class="form-group">
                    <label>í‚¤ í˜•ì‹</label>
                    <select id="keyFormat">
                        <option value="random">ëœë¤ ìƒì„±</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ìœ íš¨ ê¸°ê°„</label>
                    <select id="duration">
                        <option value="0">ë¬´ì œí•œ</option>
                        <option value="1">1ì¼</option>
                        <option value="7">7ì¼</option>
                        <option value="30">30ì¼</option>
                        <option value="90">90ì¼</option>
                        <option value="365">365ì¼</option>
                        <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    </select>
                </div>
            </div>
            <div class="form-group" id="customKeyGroup" style="display:none;">
                <label>í‚¤ ì§ì ‘ ì…ë ¥</label>
                <input type="text" id="customKey" placeholder="XXXX-XXXX-XXXX-XXXX">
            </div>
            <div class="form-group" id="customDaysGroup" style="display:none;">
                <label>ê¸°ê°„ (ì¼)</label>
                <input type="number" id="customDays" placeholder="ì¼ ìˆ˜ ì…ë ¥" min="1">
            </div>
            <button class="btn-primary" onclick="generateKey()">í‚¤ ë°œê¸‰</button>
            <div id="generatedKey" class="generated-key" style="display:none;"></div>
        </div>
        
        <!-- í‚¤ ëª©ë¡ -->
        <div class="card">
            <h2>ğŸ“‹ ë°œê¸‰ëœ í‚¤ ëª©ë¡</h2>
            <button class="btn-primary btn-sm" onclick="loadKeys()" style="margin-bottom:15px;">ìƒˆë¡œê³ ì¹¨</button>
            <table>
                <thead>
                    <tr>
                        <th>í‚¤</th>
                        <th>ìƒíƒœ</th>
                        <th>HWID</th>
                        <th>ë§Œë£Œì¼</th>
                        <th>ê´€ë¦¬</th>
                    </tr>
                </thead>
                <tbody id="keyList">
                    <tr><td colspan="5" style="text-align:center;color:#78909c;">ë¡œë”© ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://127.0.0.1:3000';
        const ADMIN_KEY = 'SUPER_SECRET_ADMIN_KEY';
        
        // í‚¤ í˜•ì‹ í† ê¸€
        document.getElementById('keyFormat').addEventListener('change', function() {
            document.getElementById('customKeyGroup').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
        
        // ê¸°ê°„ í† ê¸€
        document.getElementById('duration').addEventListener('change', function() {
            document.getElementById('customDaysGroup').style.display = 
                this.value === 'custom' ? 'block' : 'none';
        });
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(text, isError = false) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = 'alert ' + (isError ? 'alert-error' : 'alert-success');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 3000);
        }
        
        // ëœë¤ í‚¤ ìƒì„±
        function randomKey() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let key = '';
            for (let i = 0; i < 4; i++) {
                if (i > 0) key += '-';
                for (let j = 0; j < 4; j++) {
                    key += chars.charAt(Math.floor(Math.random() * chars.length));
                }
            }
            return key;
        }
        
        // í‚¤ ë°œê¸‰
        async function generateKey() {
            const format = document.getElementById('keyFormat').value;
            const durationSelect = document.getElementById('duration').value;
            
            let licenseKey = format === 'custom' 
                ? document.getElementById('customKey').value 
                : randomKey();
            
            if (!licenseKey) {
                showMessage('í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”', true);
                return;
            }
            
            let days = 0;
            if (durationSelect === 'custom') {
                days = parseInt(document.getElementById('customDays').value) || 0;
            } else {
                days = parseInt(durationSelect);
            }
            
            let expires = null;
            if (days > 0) {
                const date = new Date();
                date.setDate(date.getDate() + days);
                expires = date.toISOString();
            }
            
            try {
                const res = await fetch(`${API_URL}/api/admin/add-key`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminKey: ADMIN_KEY,
                        licenseKey: licenseKey,
                        expires: expires
                    })
                });
                
                const data = await res.json();
                if (data.success) {
                    document.getElementById('generatedKey').textContent = licenseKey;
                    document.getElementById('generatedKey').style.display = 'block';
                    showMessage('í‚¤ê°€ ë°œê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    loadKeys();
                } else {
                    showMessage('ë°œê¸‰ ì‹¤íŒ¨', true);
                }
            } catch (e) {
                showMessage('ì„œë²„ ì—°ê²° ì‹¤íŒ¨', true);
            }
        }
        
        // í‚¤ ëª©ë¡ ë¡œë“œ
        async function loadKeys() {
            try {
                const res = await fetch(`${API_URL}/api/admin/list-keys?adminKey=${ADMIN_KEY}`);
                const data = await res.json();
                
                if (data.success) {
                    const tbody = document.getElementById('keyList');
                    if (data.keys.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#78909c;">ë°œê¸‰ëœ í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = data.keys.map(k => {
                        const now = new Date();
                        const expired = k.expires && new Date(k.expires) < now;
                        let statusClass, statusText;
                        
                        if (expired) {
                            statusClass = 'status-expired';
                            statusText = 'ë§Œë£Œë¨';
                        } else if (k.bound) {
                            statusClass = 'status-active';
                            statusText = 'ì‚¬ìš© ì¤‘';
                        } else {
                            statusClass = 'status-unbound';
                            statusText = 'ë¯¸ì‚¬ìš©';
                        }
                        
                        const expiresText = k.expires 
                            ? new Date(k.expires).toLocaleDateString('ko-KR')
                            : 'ë¬´ì œí•œ';
                        
                        return `
                            <tr>
                                <td style="font-family:monospace;">${k.key}</td>
                                <td class="${statusClass}">${statusText}</td>
                                <td style="font-size:12px;color:#78909c;">${k.hwid || '-'}</td>
                                <td>${expiresText}</td>
                                <td>
                                    <button class="btn-warning btn-sm" onclick="resetKey('${k.key}')">ë¦¬ì…‹</button>
                                    <button class="btn-danger btn-sm" onclick="deleteKey('${k.key}')">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            } catch (e) {
                document.getElementById('keyList').innerHTML = 
                    '<tr><td colspan="5" style="text-align:center;color:#ef5350;">ì„œë²„ ì—°ê²° ì‹¤íŒ¨</td></tr>';
            }
        }
        
        // í‚¤ ë¦¬ì…‹ (HWID í•´ì œ)
        async function resetKey(key) {
            if (!confirm(`${key} í‚¤ì˜ HWIDë¥¼ ë¦¬ì…‹í• ê¹Œìš”?`)) return;
            
            try {
                const res = await fetch(`${API_URL}/api/admin/reset-key`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminKey: ADMIN_KEY,
                        licenseKey: key
                    })
                });
                
                const data = await res.json();
                if (data.success) {
                    showMessage('HWIDê°€ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤');
                    loadKeys();
                } else {
                    showMessage('ë¦¬ì…‹ ì‹¤íŒ¨', true);
                }
            } catch (e) {
                showMessage('ì„œë²„ ì—°ê²° ì‹¤íŒ¨', true);
            }
        }
        
        // í‚¤ ì‚­ì œ
        async function deleteKey(key) {
            if (!confirm(`${key} í‚¤ë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;
            
            try {
                const res = await fetch(`${API_URL}/api/admin/delete-key`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        adminKey: ADMIN_KEY,
                        licenseKey: key
                    })
                });
                
                const data = await res.json();
                if (data.success) {
                    showMessage('í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                    loadKeys();
                } else {
                    showMessage('ì‚­ì œ ì‹¤íŒ¨', true);
                }
            } catch (e) {
                showMessage('ì„œë²„ ì—°ê²° ì‹¤íŒ¨', true);
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í‚¤ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        loadKeys();
    </script>
</body>
</html>
